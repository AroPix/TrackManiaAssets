files:
  - installer: http://files.trackmaniaforever.com/tmunitedforever_setup.exe
  - gui: https://github.com/AroPix/TrackManiaAssets/raw/refs/heads/main/gui
game:
  arch: win64
  exe: $GAMEDIR/drive_c/Program Files (x86)/TmUnitedForever/TmForever.exe
  launch_configs:
    - args: run TmForever tminterface
      exe: $GAMEDIR/$TMLOADER_PATH/TMLoader.exe
      name: TMInterface (+ TMUnlimiter, CoreMod)
      working_dir: $GAMEDIR/$TMLOADER_PATH
    - args: run TmForever twinkietweaks
      exe: $GAMEDIR/$TMLOADER_PATH/TMLoader.exe
      name: TwinkieTweaks (+ TMUnlimiter, Comp, CoreMod)
      working_dir: $GAMEDIR/$TMLOADER_PATH
    - args: run TmForever comp
      exe: $GAMEDIR/$TMLOADER_PATH/TMLoader.exe
      name: Comp (+ CoreMod, no TMUnlimiter)
      working_dir: $GAMEDIR/$TMLOADER_PATH
    - exe: $GAMEDIR/drive_c/Program Files (x86)/TmUnitedForever/TmForever.bak.exe
      name: Vanilla (without Mods)
      working_dir: $GAMEDIR/drive_c/Program Files (x86)/TmUnitedForever
    - exe: $GAMEDIR/drive_c/Program Files (x86)/TmUnitedForever/TmForeverLauncher.exe
      name: Launcher
      working_dir: $GAMEDIR/drive_c/Program Files (x86)/TmUnitedForever
    - exe: $GAMEDIR/$TMLOADER_PATH/TMLoader.exe
      name: TMLoader Configuration Interface
      working_dir: $GAMEDIR/$TMLOADER_PATH
    - exe: $GAMEDIR/drive_c/gui
      name: Run GUI
      working_dir: $GAMEDIR/drive_c
    - exe: $GAMEDIR/drive_c/gui
      args: --openplanet
      name: Run GUI
      working_dir: $GAMEDIR/drive_c
  name: TMUnlimiter (+ Comp, CoreMod [default])
  prefix: $GAMEDIR
installer:
  - task:
      description: Creating Wine prefix
      install_mono: false
      name: create_prefix
      prefix: $GAMEDIR
  - task:
      key: winemenubuilder.exe
      name: set_regedit
      path: HKEY_CURRENT_USER\Software\Wine\DllOverrides
      prefix: $GAMEDIR
      type: REG_SZ
      value: ''
  - task:
      args: /silent
      description: Installing TrackMania Nations Forever...
      executable: installer
      name: wineexec
      prefix: $GAMEDIR
  - task:
      app: sandbox
      description: Disabling unused WINE features
      name: winetricks
      prefix: $GAMEDIR
      silent: true
  - merge:
      dst: $GAMEDIR/drive_c/
      src: gui
  - chmodx: $GAMEDIR/drive_c/gui
  - execute:
      args: --install $GAMEDIR
      description: Installing TMLoader...
      file: $GAMEDIR/drive_c/gui
  - task:
      args: update
      description: Setting TMLoader Protocol...
      executable: $GAMEDIR/$TMLOADER_PATH/TMLoader.exe
      name: wineexec
      prefix: $GAMEDIR
  - task:
      description: Running Launcher to check for update and to set graphics settings
        (You can change the settings as you please, but close the launcher for the install
        script to finish)...
      executable: $GAMEDIR/drive_c/Program Files (x86)/TmUnitedForever/TmForeverLauncher.exe
      name: wineexec
      prefix: $GAMEDIR
variables:
  TMLOADER_PATH: drive_c/Program Files/TMLoader